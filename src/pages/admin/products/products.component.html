<div class="p-2">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Gerenciar Produtos</h1>
    @if (!isFormVisible()) {
      <button (click)="showAddForm()" class="bg-primary hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300">
        Adicionar Produto
      </button>
    }
  </div>

  <!-- Add/Edit Form -->
  @if (isFormVisible()) {
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
      <h2 class="text-xl font-semibold mb-4 text-gray-700">{{ editingProduct() ? 'Editar Produto' : 'Adicionar Produto' }}</h2>
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Left Column -->
          <div>
            <div class="mb-4">
              <label for="name" class="block text-gray-600 text-sm font-medium mb-2">Nome do Produto</label>
              <input type="text" id="name" formControlName="name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
            </div>
            <div class="mb-4">
              <label for="brand" class="block text-gray-600 text-sm font-medium mb-2">Marca</label>
              <select id="brand" formControlName="brand" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                <option [value]="" disabled>Selecione a marca</option>
                @for(brand of brands; track brand) { <option [value]="brand">{{brand}}</option> }
              </select>
            </div>
            <div class="mb-4">
              <label for="category" class="block text-gray-600 text-sm font-medium mb-2">Categoria</label>
              <select id="category" formControlName="categoryId" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                <option [ngValue]="null" disabled>Selecione a categoria</option>
                @for(category of categories(); track category.id) { <option [ngValue]="category.id">{{category.name}}</option> }
              </select>
            </div>
             <div class="grid grid-cols-2 gap-4">
                <div class="mb-4">
                  <label for="price" class="block text-gray-600 text-sm font-medium mb-2">Pre√ßo</label>
                  <input type="number" id="price" formControlName="price" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
                <div class="mb-4">
                  <label for="stock" class="block text-gray-600 text-sm font-medium mb-2">Estoque</label>
                  <input type="number" id="stock" formControlName="stock" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary">
                </div>
              </div>
          </div>

          <!-- Right Column -->
          <div>
            <div class="mb-4">
              <label for="description" class="block text-gray-600 text-sm font-medium mb-2">Descri√ß√£o</label>
              <textarea id="description" formControlName="description" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
            </div>
            <div class="mb-4">
              <label for="images" class="block text-gray-600 text-sm font-medium mb-2">URLs das Imagens (uma por linha)</label>
              <textarea id="images" formControlName="images" rows="4" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary"></textarea>
            </div>
             <div class="mb-4 flex items-center">
              <input type="checkbox" id="isFeatured" formControlName="isFeatured" class="h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary">
              <label for="isFeatured" class="ml-2 text-gray-700">Produto em Destaque</label>
            </div>
          </div>
        </div>
        <div class="flex items-center space-x-4 mt-6">
            <button type="submit" [disabled]="productForm.invalid" class="bg-primary hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-300 disabled:bg-gray-400 disabled:cursor-not-allowed">
            {{ editingProduct() ? 'Salvar Altera√ß√µes' : 'Adicionar Produto' }}
            </button>
            <button type="button" (click)="cancelEdit()" class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-lg transition duration-300">
            Cancelar
            </button>
        </div>
      </form>
    </div>
  }

  <!-- Products Table -->
  <div class="bg-white shadow-md rounded-lg overflow-x-auto">
    <table class="w-full table-auto">
      <thead class="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
        <tr>
          <th class="py-3 px-6 text-left">Produto</th>
          <th class="py-3 px-6 text-left">Categoria</th>
          <th class="py-3 px-6 text-right">Pre√ßo</th>
          <th class="py-3 px-6 text-center">Estoque</th>
          <th class="py-3 px-6 text-center">Destaque</th>
          <th class="py-3 px-6 text-center">A√ß√µes</th>
        </tr>
      </thead>
      <tbody class="text-gray-600 text-sm font-light">
        @for (product of products(); track product.id) {
          <tr class="border-b border-gray-200 hover:bg-gray-50">
            <td class="py-3 px-6 text-left">
              <div class="flex items-center">
                <img [src]="product.images[0] || 'https://via.placeholder.com/40'" class="w-10 h-10 rounded-md mr-4 object-cover" [alt]="product.name">
                <span class="font-medium">{{ product.name }}</span>
              </div>
            </td>
            <td class="py-3 px-6 text-left">{{ getCategoryName(product.categoryId) }}</td>
            <td class="py-3 px-6 text-right font-medium">{{ product.price | currency:'BRL' }}</td>
            <td class="py-3 px-6 text-center">{{ product.stock }}</td>
            <td class="py-3 px-6 text-center">
              @if (product.isFeatured) {
                <span class="bg-green-200 text-green-600 py-1 px-3 rounded-full text-xs">Sim</span>
              } @else {
                <span class="bg-gray-200 text-gray-600 py-1 px-3 rounded-full text-xs">N√£o</span>
              }
            </td>
            <td class="py-3 px-6 text-center">
              <div class="flex item-center justify-center space-x-2">
                <button (click)="showEditForm(product)" class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 text-gray-600 hover:bg-gray-300 transform hover:scale-110 transition-transform duration-200">
                  ‚úèÔ∏è
                </button>
                <button (click)="deleteProduct(product.id)" class="w-8 h-8 flex items-center justify-center rounded-full bg-red-100 text-red-600 hover:bg-red-200 transform hover:scale-110 transition-transform duration-200">
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
        } @empty {
          <tr>
            <td colspan="6" class="text-center py-6 text-gray-500">Nenhum produto encontrado.</td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>
